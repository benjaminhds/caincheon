<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin.mboardmngmt">

	<!--
	============================================================
	
	============================================================
	-->
	<!-- 전체 목록 조회 -->
	<select id="selectMBoardMngtCategory" parameterType="hashmap" resultType="hashmap">
		<include refid="common.pagingPre"/>
			SELECT B.NAME AS CATEGORY_NAME, ISNULL(C.NAME,'') AS CHURCH_NAME, ISNULL(D.NAME,'') AS DEPART_NAME, ISNULL(O.NAME, '') AS ORG_NAME 
			, A.* FROM ( 
				SELECT M.*
				, C.C_IDX, C.NAME C_NAME, C.IDX C_SEQ, C.IS_USE
				FROM MBOARD_MNGT M 
				LEFT OUTER JOIN MBOARD_CATEGORY C ON C.B_IDX = M.B_IDX
				<if test='b_nm != null and !b_nm.equals("")'>
				AND M.B_NM LIKE CONCAT('%',#{b_nm},'%') 
				</if>
				<if test='b_idx != null and !b_idx.equals("")'> 
				AND M.B_IDX = #{b_idx} 
				</if> 
			) A 
			LEFT OUTER JOIN MBOARD_CATEGORY B ON B.C_IDX      = A.C_IDX      AND B.B_IDX=A.B_IDX AND B.IS_USE='Y' 
			LEFT OUTER JOIN ORG_HIERARCHY   O ON O.ORG_IDX    = A.DEPART_IDX 
			LEFT OUTER JOIN CHURCH          C ON C.CHURCH_IDX = A.CHURCH_IDX 
			LEFT OUTER JOIN DEPARTMENT      D ON D.DEPART_IDX = A.DEPART_IDX 
			WHERE RNUM BETWEEN ${startRnum} AND ${endRnum}
			<if test='name != null and !name.equals("")'>
			AND  NAME LIKE CONCAT('%',#{name},'%') 
			</if> 
			ORDER BY A.NOTICE_TYPE, A.REGDATE DESC, A.BL_IDX DESC 
		<include refid="common.pagingPost"/> 
	</select>
	
	
	<!-- 
	<select id="selectAd" parameterType="hashmap" resultType="hashmap">
		SELECT
			REG_ID 		AS regid
		FROM
			TBL_AD
		WHERE
			AID = #{id}
	</select>
	
	<select id="selectAdAndImg" parameterType="hashmap" resultType="hashmap">
		SELECT
			A.AID		AS id,
			A.CATEGORY	AS category,
			A.REG_ID 	AS regid
		FROM
			TBL_AD A LEFT JOIN TBL_AD_IMG_FILE B
			ON A.AID = B.ID  AND B.ID_TYPE = #{id_type} AND B.STATUS = 'Y'
		WHERE
			A.AID = #{id}
	</select>
	
	<insert id="insertAd" parameterType="hashmap" useGeneratedKeys="true" keyProperty="AID">
		INSERT INTO	TBL_AD
		(
			ANAME,
			URL,
			TITLE,
			STATUS,
			ORDERING,
			REG_ID
		)
		VALUES
        (
			#{name},
			#{url},
			#{title},
			#{subtitle},
			#{client},
			#{comment},
			#{point},
			#{sdate},
			#{edate},
			#{status},
			#{ordering},
			#{loginid}
        )
	</insert>
	
	<update id="updateAd" parameterType="hashmap">
		UPDATE TBL_AD
			SET
				ANAME 		= #{name},
				URL		 	= #{url},
				TITLE		= #{title},
				SUBTITLE	= #{subtitle},
				CLIENT		= #{client},
				COMMENT		= #{comment},
				POINT		= #{point},
				REDIRECT	= #{redirect},
			<if test='imgseq != null and !imgseq.equals("")'>
				IMG_PATH	= #{imgpath},
				IMG_SEQ		= #{imgseq},
			</if>
				CATEGORY	= #{category},
				S_DATE		= #{sdate},
				E_DATE		= #{edate},
				STATUS 		= #{status},
				ORDERING	= #{ordering},
				MOD_DATE 	= NOW()
		WHERE
			AID = #{id}
	</update>
	
	<delete id="deleteAd" parameterType="hashmap">
		DELETE FROM TBL_AD
		WHERE
			AID = #{id}	
	</delete>
	
	<select id="selectAdBannerAndImg" parameterType="hashmap" resultType="Ad">
		SELECT
			A.BID			AS id,
			A.REG_ID 		AS regid
		FROM
			TBL_AD_BANNER A LEFT JOIN TBL_AD_IMG_FILE B
		WHERE
			A.BID = #{id}
	</select>
	
	<insert id="insertAdBanner" parameterType="hashmap" useGeneratedKeys="true" keyProperty="BID">
		INSERT INTO	TBL_AD_BANNER
		(
			BNAME,
			URL,
			CLIENT,
			COMMENT,
			ORDERING,
			REG_ID
		)
		VALUES
        (
			#{name},
			#{url},
			#{client},
			#{comment},
			#{point},
			#{redirect},
			#{status},
			#{ordering},
			#{loginid}
        )
	</insert>
	
	<update id="updateAdBanner" parameterType="hashmap">
		UPDATE TBL_AD_BANNER
			SET
				BNAME 		= #{name},
				URL		 	= #{url},
				CLIENT		= #{client},
				COMMENT		= #{comment},
				POINT		= #{point},
				REDIRECT	= #{redirect},
				IMG_URL		= #{imgurl},
			<if test='imgseq != null and !imgseq.equals("")'>
				IMG_PATH	= #{imgpath},
				IMG_SEQ		= #{imgseq},
			</if>
				S_DATE		= #{sdate},
				E_DATE		= #{edate},
				STATUS 		= #{status},
				ORDERING	= #{ordering},
				MOD_DATE 	= NOW()
		WHERE
			BID = #{id}
	</update>
	 -->
	
	
</mapper>