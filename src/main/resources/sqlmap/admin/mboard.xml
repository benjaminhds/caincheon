<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin.mboard">
	<!-- 메인 메뉴 리스트 조회 -->
	<select id="getMenuBoardList" parameterType="hashmap" resultType="hashmap">
		/* admin.mboard.getMenuBoardList - 메인메뉴리스트*/
			SELECT TOP 100 PERCENT *  
			FROM MBOARD_MNGT
			WHERE 1=1
			<if test='i_sViewFlag != null and !"".equals(i_sViewFlag)'> AND VIEW_FLAG	= #{i_sViewFlag} </if>
			ORDER BY B_IDX ASC
	</select>
	<select id="getMBoardList" parameterType="hashmap" resultType="hashmap">
		/* admin.mboard.getMBoardList */
			<include refid="common.pagingPre"/>
			SELECT TOP 100 PERCENT *  
			FROM MBOARD_MNGT
			WHERE 1=1
			<if test='i_sText != null and !"".equals(i_sText)'> AND B_NM LIKE CONCAT('%', #{i_sText}, '%') </if>
			<if test='i_sBidx != null and !"".equals(i_sBidx)'> AND B_IDX		= #{i_sBidx},'%') </if>
			<include refid="common.pagingPost"/>
	</select>
	<!-- 게시판 조회 -->
	<select id="getCodeInstance" parameterType="hashmap" resultType="hashmap">
		/* admin.mboard.getCodeInstance 코드 조회*/
		SELECT	* 
		FROM	CODE_INSTANCE
		WHERE	1=1
		<if test='code != null and !"".equals(code)'> AND CODE = #{code} </if>	<!-- 코드 조회 -->
	</select>
	<!-- 게시판 조회 -->
	<select id="getCategory" parameterType="hashmap" resultType="hashmap">
		/* admin.mboard.getCategory 카테고리 조회*/
		SELECT	* 
		FROM	MBOARD_CATEGORY
		WHERE	1=1
		<if test='i_sBidx != null and !"".equals(i_sBidx)'> AND B_IDX = #{i_sBidx} </if>	<!-- 게시글 아이디 조회 -->
	</select>
	<!-- 게시판 조회 -->
	<select id="getMboardView" parameterType="hashmap" resultType="hashmap">
		/* admin.mboard.getMboardView 게시판 조회 */
		SELECT	B_IDX
				, B_NM
				, B_KIND
				, B_TYPE
				, REG_DT
				, UPD_DT
				, USEYN_COMMENT
				, USEYN_SECRET
				, USEYN_COMMENT_SECRET
				, USEYN_ATTACHEMENT
				, USEYN_LOGIN
				, USEYN_DOWNLOAD_PERM
				, VIEW_FLAG
		FROM	MBOARD_MNGT
		WHERE	1=1
		<if test='i_sBidx != null and !"".equals(i_sBidx)'> AND B_IDX = #{i_sBidx} </if>	<!-- 게시글 아이디 조회 -->
	</select>
	<insert id="insertMboardMaster" parameterType="hashmap">
		/* admin.mboard.insertMboardMaster 게시판 등록 */
		INSERT	INTO	MBOARD_MNGT
			(
				B_NM
				, B_KIND
				, B_TYPE
				, REG_DT
				, UPD_DT
				, USEYN_COMMENT
				, USEYN_SECRET
				, USEYN_COMMENT_SECRET
				, USEYN_ATTACHEMENT
				, USEYN_LOGIN
				, USEYN_DOWNLOAD_PERM
				, VIEW_FLAG
			)
		VALUES
			(
				#{i_sTitle}
				, #{i_sBoardKind}
				, #{i_sBoardType}
				, Convert(varchar(10),Getdate(),112)
				, Convert(varchar(10),Getdate(),112)
				, #{i_sUseYnComment}
				, #{i_sUseYnSecret}
				, #{i_sUseYnCommentSecret}
				, #{i_sUseYnAttachMent}
				, #{i_sUseYnLogin}
				, #{i_sUseYnDownloadPerm}
				, #{i_sViewFlag}
			)
		<selectKey resultType="java.lang.Integer" keyProperty="i_sBidx">
			SELECT	@@IDENTITY AS ID
		</selectKey>
	</insert>
	<update id="updateMboardMaster" parameterType="hashmap">
		UPDATE	MBOARD_MNGT
		SET
			B_NM					=	#{i_sTitle}
			, B_KIND				=	#{i_sBoardKind}
			, B_TYPE				=	#{i_sBoardType}
			, UPD_DT				=	Convert(varchar(10),Getdate(),112)
			, USEYN_COMMENT			=	#{i_sUseYnComment}
			, USEYN_SECRET			=	#{i_sUseYnSecret}
			, USEYN_COMMENT_SECRET	=	#{i_sUseYnCommentSecret}
			, USEYN_ATTACHEMENT		=	#{i_sUseYnAttachMent}
			, USEYN_LOGIN			=	#{i_sUseYnLogin}
			, USEYN_DOWNLOAD_PERM	=	#{i_sUseYnDownloadPerm}
			, VIEW_FLAG				=	#{i_sViewFlag}
		WHERE	B_IDX				=	#{i_sBidx}
	</update>
	<delete id="deleteMbaord" parameterType="hashmap">
		DELETE	FROM	MBOARD_MNGT
		WHERE	1=1
		<if test='i_sBidx != null and !"".equals(i_sBidx)'> AND B_IDX = #{i_sBidx} </if>	<!-- 게시글 아이디 조회 -->
	</delete>
	<delete id="deleteMboardCategroy" parameterType="hashmap">
		DELETE	FROM	MBOARD_CATEGORY
		WHERE	1=1
		<if test='i_sBidx != null and !"".equals(i_sBidx)'> AND B_IDX = #{i_sBidx} </if>	<!-- 게시글 아이디 조회 -->
	</delete>
	<insert id="insertMboardCategroy" parameterType="hashmap">
		INSERT	INTO	MBOARD_CATEGORY
			(
				B_IDX
				, C_IDX
				, NAME
				, IS_USE
			)
		VALUES
			(
				#{i_sBidx}
				, #{i_sCIdx}
				, #{i_sName}
				, 'Y'
			)
	</insert>
	<select id="getNormalboardList" parameterType="hashmap" resultType="hashmap">
		<include refid="common.pagingPre"/>
				SELECT B.NAME AS CATEGORY_NAME
					, ISNULL(C.NAME,'') AS CHURCH_NAME
					, ISNULL(D.NAME,'') AS DEPART_NAME
					, ISNULL(O.NAME, '') AS ORG_NAME
					, A.*
					, ROW_NUMBER() OVER(ORDER BY A.REGDATE, A.BL_IDX DESC) AS R_NUM
				FROM (
					SELECT	BL_IDX
							, TITLE
							, CONTENT
							, USER_ID
							, WRITER
							, PWD
							, REGDATE
							, UPDDATE
							, EMAIL
							, IS_VIEW
							, IS_SECRET
							, DEPART_IDX
							, CHURCH_IDX
							, HIT
							, B_IDX
							, IS_NOTICE
							, C_IDX
							, DISPLAY_YN
							, EVENT_DATE
							, DOWN_LEVEL
							, UPDATE_ID
					FROM MBOARD M
					WHERE M.B_IDX	=	'9'
				) A
				LEFT OUTER JOIN MBOARD_CATEGORY B
					ON B.C_IDX		= A.C_IDX
					AND B.B_IDX		= A.B_IDX
					AND B.IS_USE	= 'Y'
				LEFT OUTER JOIN ORG_HIERARCHY   O
					ON O.ORG_IDX    = A.DEPART_IDX
				LEFT OUTER JOIN CHURCH          C
					ON C.CHURCH_IDX = A.CHURCH_IDX
				LEFT OUTER JOIN DEPARTMENT      D
					ON D.DEPART_IDX = A.DEPART_IDX
		<include refid="common.pagingPost"/> 
	</select>
</mapper>