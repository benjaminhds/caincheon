<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="front.home">

	<!-- ===============================================================
		
		 ============================================================ -->
	<!-- 지구코드별 성당 조회 -->
	<select id="get_gigu_codes_in_church" parameterType="hashmap" resultType="hashmap">
		<!-- <include refid="common.pagingPre"/> -->
			SELECT /* front.home.get_gigu_codes_in_church */ C.GIGU_CODE, D.NAME GIGU_NAME, C.CHURCH_IDX, C.NAME
			FROM CHURCH C, CODE_INSTANCE D
			WHERE C.GIGU_CODE = D.CODE_INST
			AND D.CODE='000004'
			ORDER BY C.GIGU_CODE ASC, C.NAME ASC
		<!-- <include refid="common.pagingPost"/> -->
	</select>
	
	
	<!-- today contents -->
	<select id="get_today_contents" parameterType="hashmap" resultType="hashmap">
		SELECT /* front.home.get_today_contents */ CONVERT(CHAR(10),A.H_DATE,102) AS H_DATE 
		, A.DESCRIPTION
		, A.TALK
		, LEFT(CONVERT(CHAR(10),A.H_DATE,2),5) YYMM
		, (DATEPART(WW, A.H_DATE) - DATEPART(WW, CONVERT(DATETIME, LEFT(CONVERT(VARCHAR, A.H_DATE, 112), 6) + '01', 112)) + 1) WEEK  
		FROM HOLIDAY A
		WHERE CONVERT(CHAR(10),H_DATE,121) = CONVERT(CHAR(10),GETDATE(),121)
	</select>
	
	
	<!-- 여러개의 보드를 한번에 조회하는 쿼리 -->
	<select id="get_multi_board" parameterType="hashmap" resultType="hashmap">
		SELECT B.R$NUM, B.B_IDX, B.C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
, ISNULL(B2.B_NM,'') AS B_NM, ISNULL(M.C_NM, '') AS C_NM, ISNULL(O.NAME,'') AS ORG_NM
FROM (
  SELECT TOP  2 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구소식') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='Y' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  4 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구소식') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP 10 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구앨범') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  5 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구영상') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  5 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교회소식') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  5 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구일정') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  5 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='교구정동정') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
  UNION ALL
  SELECT TOP  5 ROW_NUMBER() OVER(ORDER BY B.REGDATE DESC) R$NUM, B.B_IDX, ISNULL(B.C_IDX,null) AS C_IDX, B.BL_IDX, B.IS_NOTICE, B.TITLE, B.ORG_IDX, B.CHURCH_IDX, B.DEPART_IDX, B.REGDATE
  FROM MBOARD B, (SELECT B_IDX, B_NM, B_TYPE FROM MBOARD_MNGT WHERE B_NM='인천주보') M
  WHERE B.B_IDX = M.B_IDX AND B.IS_NOTICE='N' AND B.IS_VIEW='Y'
) B 
  INNER JOIN MBOARD_MNGT B2 ON B2.B_IDX = B.B_IDX
  LEFT OUTER JOIN ORG_HIERARCHY O  ON O.ORG_IDX = B.ORG_IDX
  LEFT OUTER JOIN  (SELECT M.B_IDX, M.B_NM, M.B_TYPE, C.C_IDX, C.NAME AS C_NM
                    FROM MBOARD_MNGT M LEFT OUTER JOIN MBOARD_CATEGORY C ON M.B_IDX = C.B_IDX ) M ON B.B_IDX = M.B_IDX AND M.C_IDX = B.C_IDX
	</select>
	
</mapper>